<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, Helvetica, sans-serif;
}

.page-heading {
  position: fixed;
  top: 0;
  width: 100%;
  background-color: #f4f4f4;
  font-size: 24px;
  font-weight: bold;
  padding: 10px 20px;
  z-index: 1001;
  border-bottom: 1px solid #ccc;
  display: flex;
  justify-content: center;
  align-items: center;
}

.page-heading .logout-form {
  position: absolute;
  right: 60px;
}

.page-heading .logout-form button {
  padding: 7px 14px;
  font-size: 18px;
  cursor: pointer;
}

.tab-header {
  position: fixed;
  top: 50px; 
  width: 100%;
  background-color: white;
  padding: 5px 0;
  z-index: 1000;
  text-align: center;
}

.tablink {
  display: inline-block;
  color: black;
  text-align: center;
  padding: 14px;
  text-decoration: none;
  font-size: 17px;
  border-radius: 5px;
  background-color: #eee;
  border: none;
  cursor: pointer;
}

.tablink:hover {
  background-color: #ddd;
  color: black;
}

.tabcontent {
  border-color: white;
  color: Black;
  display: none;
  padding: 140px 20px 20px;
  height: 100%;
  text-align: center;
}

/* Search styles */
#searchBox {
  width: 400px;
  padding: 10px;
  font-size: 16px;
}
#results {
  margin-top: 20px;
  text-align: left;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}
.result {
  border-bottom: 1px solid #ccc;
  padding: 10px 0;
}
.result h3 {
  margin: 0;
  color: #007BFF;
}
.result p {
  margin: 5px 0 0;
}
</style>
<script>
    function openPage(pageName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablink");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].style.backgroundColor = "";
      }
      document.getElementById(pageName).style.display = "block";
    }

    window.onload = function() {
      document.getElementById("defaultOpen").click();
    }

    let timeout = null;

    function handleSearch() {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
            const query = document.getElementById('searchBox').value.trim();
            if (query.length < 3) {
                document.getElementById('results').innerHTML = '';
                return;
            }

            fetch(`/search?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    const resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = '';

                    if (data.length === 0) {
                        resultsDiv.innerHTML = '<p>No results found.</p>';
                    } else {
                        data.forEach(item => {
                            const result = document.createElement('div');
                            result.className = 'result';
                            result.innerHTML = `
                                <h3>${item.title}</h3>
                                <p>${item.description}</p>
                                <small>Relevance Score: ${item.score.toFixed(2)}</small>
                            `;
                            resultsDiv.appendChild(result);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                });
        }, 300); // debounce
    }
</script>
</head>

<body>
    <div class="page-heading">
        <span>Knowledge-Base Article Management</span>
        <form class="logout-form" action="{{ url_for('logout') }}" method="post">
          <button type="submit">Logout</button>
        </form>
    </div>
      
    <div class="tab-header">
        <a class="tablink" onclick="openPage('Home', this)" id="defaultOpen">Home</a>
        <a class="tablink" href="{{ url_for('submit') }}">Add KB Article</a>
        <a class="tablink" href="{{ url_for('my_articles') }}">My Articles</a>
        {% if is_admin %}
          <a class="tablink" href="{{ url_for('admin') }}">Approve Articles</a>
        {% endif %}
    </div>

    <div id="Home" class="tabcontent">
        <h1>Welcome {{ name }} to Knowledge-Base Articles Page!</h1>
        <input type="text" id="searchBox" placeholder="Enter your query..." onkeyup="handleSearch()" />
        <div id="results"></div>
    </div>
</body>
</html>
